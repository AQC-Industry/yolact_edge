FROM ubuntu:18.04 AS base

ARG DEBIAN_FRONTEND=noninteractive
RUN apt-get update && apt-get install -y  \
    git wget build-essential \
    python3 python3-setuptools python3-pip python3-dev python3-tk \
    ffmpeg libsm6 libxext6
RUN ln -svf /usr/bin/python3 /usr/bin/python
RUN python -m pip install --upgrade --force pip

# # Install dependencies
RUN pip install cython opencv-python pillow matplotlib GitPython termcolor tensorboard packaging tqdm pandas
RUN pip install git+https://github.com/haotian-liu/cocoapi.git#"egg=pycocotools&subdirectory=PythonAPI"
RUN pip install torch==1.7.1 torchvision==0.8.2 -f https://download.pytorch.org/whl/torch_stable.html


FROM base AS local

ENV PRODUCTION=False
ENV ENV="local"

WORKDIR /root/yolact_edge

ENV LANG C.UTF-8


FROM base AS dev

ENV PRODUCTION=False
ENV ENV=dev

WORKDIR /root/yolact_edge

COPY . .

CMD ["python", "run_inference.py"]
